{
  "$schema": "http://citizenlab.co/tenant_settings_spec.json",
  "description": "Schema for validating the settings on a tenant",
  "type": "object",
  "required": ["core"],
  "additionalProperties": false,
  "properties":
    {
      "core": {
        "allOf": [
          {"$ref": "#/definitions/feature"},
          {
            "description": "The core of the system. Container for general settings. Always enabled",
            "required-settings": ["organization_type", "timezone","locales"],
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {},
              "organization_type": {
                "type": "string",
                "enum": ["city", "generic"]
              },
              "timezone": {
                "type": "string",
                "default": "Europe/Brussels",
                "enum": [<%= TZInfo::Timezone.all_identifiers.map{|tz| ['"',tz,'"'].join}.join(",") %>]
              },
              "locales": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": [<%= I18n.available_locales.map{|l| "\"#{l}\""}.join(",") %>]
                },
                "uniqueItems": true
              },
              "organization_name": { 
                "$ref": "#/definitions/multiloc_string" 
              },
              "style_main_bg": {
                "type": "string",
                "pattern": "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"
              },
              "style_main_fg": {
                "type": "string",
                "pattern": "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"
              },
              "style_accent_bg": {
                "type": "string",
                "pattern": "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"
              },
              "style_accent_fg": {
                "type": "string",
                "pattern": "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"
              }
            }
          }
        ]
      },

      "topics": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"Topics can be shown",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "map": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"Displaying a map where all ideas are plotted on",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "areas": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"Allow geographical areas(neighbourhoods, cities ...) to be defined",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "pages": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"Allow custom pages to be made, and potentially be added to the navigation",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "facebook_login": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"Allow signing in and registering through a facebook account",
            "additionalProperties": false,
            "required-settings": ["app_id"],
            "properties": {
              "allowed": {},
              "enabled": {},
              "app_id": {
                "type": "string"
              },
              "app_secret": {
                "type": "string",
                "private": true
              }
            }
          }
        ]
      },

      "google_login": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"Allow signing in and registering through a google account",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "twitter_login": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"Allow signing in and registering through twitter",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "comments": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"Allow comments to be posted on ideas",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "comments_votes": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"Allow users to vote on comments",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "comments_mentions": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"@user (twitter style) mentions generate notifications",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "notifications": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "ideas_votes": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"Votes can be placed on an idea",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "ideas_images": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"ideas can contain image(s)",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "ideas_location": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"Allows location",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "ideas_attachments": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"Allow attachments",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "projects": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "projects_phases": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "projects_pages": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "projects_events": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "projects_info": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "projects_map": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "projects_perimeter": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "multi_locales": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "email_digest_user": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "email_digest_admin": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "excel_export": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":	"",
            "additionalProperties": false,
            "properties": {
              "allowed": {},
              "enabled": {}
            }
          }
        ]
      },

      "mixpanel_tracking": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description":  "Allows the app interactions of the users to be tracked by mixpanel",
            "additionalProperties": false,
            "required-settings": ["project_token"],
            "properties": {
              "allowed": {},
              "enabled": {},
              "project_token": {
                "type": "string"
              }
            }
          }
        ]
      },

      "ga_tracking": {
        "allOf": [
          {"$ref": "#definitions/feature"},
          {
            "description": "Allows the app interactions of the users to be tracked by Google Analytics",
            "additionalProperties": false,
            "required-settings": ["tracking_id"],
            "properties": {
              "allowed": {},
              "enabled": {},
              "tracking_id": {
                "type": "string"
              }
            }
          }
        ]
      }

    },
  "dependencies": {
    "comments_votes": ["ideas_comments"],
    "comments_mentions": ["notifications"],
    "projects_map": ["projects"],
    "projects_info": ["projects"],
    "projects_perimeter": ["projects"],
    "projects_pages": ["projects"],
    "projects_events": ["projects"],
    "projects_phases": ["projects"]
  },
  "definitions": {
    "multiloc_string": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        <%= I18n.available_locales.map{|l| "\"#{l.to_s}\": {\"type\": \"string\"}"}.join(",") %>
      }
    },
    "feature": {
      "type": "Object",
      "required": ["allowed","enabled"],
      "properties": {
        "allowed": {
          "type": "boolean"
        },
        "enabled": {
          "type": "boolean"
        }
      }
    }
  }
}
