{
  "description": "Schema for validating the settings on a tenant",
  "type": "object",
  "required": ["core"],
  "additionalProperties": false,
  "properties":
    {
      "core": {
        "type": "object",
        "description": "The core of the system. Container for general settings. Always enabled",
        "required-settings": ["organization_type", "timezone", "currency", "locales", "color_main", "color_secondary","color_text"],
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true},
          "organization_type": {
            "description": "For a city: <40k small, >40k medium, >120k large. Otherwise: generic",
            "type": "string",
            "enum": ["small_city", "medium_city", "large_city", "generic", "demo"],
            "default": "medium_city"
          },
          "lifecycle_stage": {
            "description": "The lifecycle stage the customer is currently at",
            "type": "string",
            "enum": ["demo", "active", "churned", "not_applicable"],
            "default": "demo"
          },
          "timezone": {
            "type": "string",
            "default": "Europe/Brussels",
            "enum": [<%= TZInfo::Timezone.all_identifiers.map{|tz| ['"',tz,'"'].join}.join(",") %>]
          },
          "currency": {
            "type": "string",
            "default": "EUR",
            "enum": [<%= CL2_SUPPORTED_CURRENCIES.map{|l| "\"#{l}\""}.join(",") %>]
          },
          "locales": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [<%= CL2_SUPPORTED_LOCALES.map{|l| "\"#{l}\""}.join(",") %>]
            },
            "uniqueItems": true,
            "minItems": 1,
            "default": "en"
          },
          "organization_name": {
            "description": "The name of the city or organization, used throughout the platform",
            "$ref": "#/definitions/multiloc_string"
          },
          "organization_site": {
            "description": "The URL to the website of the orginization",
            "type": "string",
            "pattern": "^$|^((http:\/\/.+)|(https:\/\/.+))"
          },
          "header_title": {
            "description": "The main title shown on the homepage (max 45 characters)",
            "type": "object",
            "additionalProperties": false,
            "properties": {
              <%= CL2_SUPPORTED_LOCALES.map{|l| "\"#{l.to_s}\": {\"type\": \"string\", \"maxLength\": 45}" }.join(",") %>
            }
          },
          "header_slogan": {
            "description": "The subtitle shown on the homepage (max 90 characters)",
            "type": "object",
            "additionalProperties": false,
            "properties": {
              <%= CL2_SUPPORTED_LOCALES.map{|l| "\"#{l.to_s}\": {\"type\": \"string\", \"maxLength\": 90}" }.join(",") %>
            } 
          },
          "meta_title": {
            "description": "The title of the homepage, shown on the browser tab and in search engine results",
            "$ref": "#/definitions/multiloc_string" 
          },
          "meta_description": {
            "description": "The description of the platform shown on links on social media",
            "$ref": "#/definitions/multiloc_string" 
          },
          "color_main": {
            "description": "The main brand color as a hexadecimal value including the anchor character",
            "type": "string",
            "pattern": "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$",
            "default": "#163A7D"
          },
          "color_secondary": {
            "description": "The secondary brand color as a hexadecimal value including the anchor character",
            "type": "string",
            "pattern": "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$",
            "default": "#CF4040"
          },
          "color_text": {
            "description": "The text brand color as a hexadecimal value including the anchor character",
            "type": "string",
            "pattern": "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$",
            "default": "#163A7D"
          },
          "signup_helper_text": {
            "description": "An optional short text, shown on top of the sign up form. Keep it short. Supports HTML",
            "$ref": "#/definitions/multiloc_string"
          },
          "custom_onboarding_message": {
            "description": "Optional text that is shown with buttons for a user that's signed in",
            "$ref": "#/definitions/multiloc_string",
            "private": true
          },
          "custom_onboarding_button": {
            "description": "Text on the CTA button next to the custom onboarding message",
            "$ref": "#/definitions/multiloc_string",
            "private": true
          },
          "custom_onboarding_link": {
            "description": "The location the CTA button links to. Should be a relative link (start with /)",
            "type": "string",
            "pattern": "^$|^/.*$",
            "private": true
          },
          "custom_onboarding_fallback_message": {
            "description": "Optional text that is shown when there's nothing to report for a user that's signed in",
            "$ref": "#/definitions/multiloc_string"
          },
          "currently_working_on_text": {
            "description": "Text shown on top of the project cards, leave empty for default",
            "$ref": "#/definitions/multiloc_string"
          }
        }
      },

      "pages": {
        "type": "object",
        "description":	"Allow custom pages to be made, and potentially be added to the navigation",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },

      "password_login": {
        "type": "object",
        "description":  "Allow signing in with normal email/password",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },

      "facebook_login": {
        "type": "object",
        "description":	"Allow signing in and registering through a facebook account",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "required-settings": ["app_id"],
        "properties": {
          "allowed": { "type": "boolean", "default": false},
          "enabled": { "type": "boolean", "default": false},
          "app_id": {
            "type": "string"
          },
          "app_secret": {
            "type": "string",
            "private": true
          }
        }
      },

      "google_login": {
        "type": "object",
        "description":  "Allow signing in and registering through a google account",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "required-settings": ["client_id", "client_secret"],
        "properties": {
          "allowed": { "type": "boolean", "default": false},
          "enabled": { "type": "boolean", "default": false},
          "client_id": {
            "type": "string"
          },
          "client_secret": {
            "type": "string",
            "private": true
          }
        }
      },

      "azure_ad_login": {
        "type": "object",
        "description":  "Allow signing in and registering with Azure Active Directory (used for e.g. VUB)",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "required-settings": ["tenant", "client_id", "logo_url", "login_mechanism_name"],
        "properties": {
          "allowed": { "type": "boolean", "default": false},
          "enabled": { "type": "boolean", "default": false},
          "tenant": {
            "type": "string",
            "private": true
          },
          "client_id": {
            "description": "Sometimes also called 'application_id'",
            "type": "string",
            "private": true
          },
          "logo_url": {
            "type": "string",
            "pattern": "^https:\/\/.+",
            "description": "The full url to a logo image, that will be shown on the authentication button. Should be approximately 25px in height."
          },
          "login_mechanism_name": {
            "type": "string",
            "description": "The name of the login mechanism. Will be used in copy like 'Sign up with {login_mechanism_name}'"
          }
        }
      },

      "franceconnect_login": {
        "type": "object",
        "description":  "Allow signing in and registering through a FranceConnect account.",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "required-settings": ["environment", "identifier", "secret"],
        "properties": {
          "allowed": { "type": "boolean", "default": false},
          "enabled": { "type": "boolean", "default": false},
          "environment": {
            "type": "string",
            "description": "Are we live on the production FranceConnect environment, or still testing on their integration environment?",
            "enum": ["production", "integration"],
            "default": "production",
            "private": true
          },
          "identifier": {
            "type": "string",
            "private": true
          },
          "secret": {
            "type": "string",
            "private": true
          }
        }
      },

      /* "twitter_login": {
        "type": "object",
        "description":  "Allow signing in and registering through a twitter account",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "required-settings": ["client_id", "client_secret"],
        "properties": {
          "allowed": { "type": "boolean", "default": false},
          "enabled": { "type": "boolean", "default": false},
          "api_key": {
            "type": "string"
          },
          "api_secret": {
            "type": "string",
            "private": true
          }
        }
      }, */

      "integration_onze_stad_app": {
        "type": "object",
        "description":  "Allow posting ideas to Onze StadApp as news.",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "required-settings": ["app_id", "api_key"],
        "properties": {
          "allowed": { "type": "boolean", "default": false},
          "enabled": { "type": "boolean", "default": false},
          "app_id": {
            "type": "string",
            "private": true
          },
          "api_key": {
            "type": "string",
            "private": true
          }
        }
      },

      "projects": {
        "type": "object",
        "description":	"",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },

      "manual_project_sorting": {
        "type": "object",
        "description":  "When active, projects are shown in the order that they've been manually drag&dropped in the admin. Otherwise the ordering is automated",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": false}
        }
      },

      "projects_phases": {
        "type": "object",
        "description":	"",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },

      "projects_pages": {
        "type": "object",
        "description":	"",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },

      "projects_events": {
        "type": "object",
        "description":	"",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },

      "projects_info": {
        "type": "object",
        "description":	"",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },

      "excel_export": {
        "type": "object",
        "description":	"",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },
      "groups": {
        "type": "object",
        "description":  "Assemble users in groups",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },
      "private_projects": {
        "type": "object",
        "description":  "Make projects visible to certain groups only",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },
      "surveys": {
        "type": "object",
        "description":  "Allow the embedding of surveys from Typeform, Survey Monkey and Google Forms",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },
      "typeform_surveys": {
        "type": "object",
        "description":  "Allow the embedding of surveys from Typeform",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true},
          "user_token": {
            "description": "The user token that can be generated from your typeform profile. Survey results will only be downloadable for this typeform profile",
            "type": "string",
            "private": true,
            "default": "<%= ENV.fetch('DEFAULT_TYPEFORM_USER_TOKEN', '') %>" 
          }
        }
      },
      "google_forms_surveys": {
        "type": "object",
        "description":  "Allow the embedding of Google Form surveys",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },
      "surveymonkey_surveys": {
        "type": "object",
        "description":  "Allow the embedding of Surveymonkey surveys. Deprecated, since not supported on mobile",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": false},
          "enabled": { "type": "boolean", "default": false}
        }
      },
      "maps": {
        "type": "object",
        "description":  "Show maps throughout the platform",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true},
          "tile_provider": {
            "description": "The OSM compatible tile provider URL pattern. Https is required.",
            "type": "string",
            "pattern": "^https:\/\/.+",
            "default": "https://free.tilehosting.com/styles/positron/style.json?key=DIZiuhfkZEQ5EgsaTk6D"
          },
          "map_center": {
            "description": "The default center point of the map. Use a dot as decimal separator.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "lat": {
                "type": "string",
                "default": "50.8503"
              },
              "long": {
                "type": "string",
                "default": "4.3517"
              }
            }
          },
          "zoom_level": {
            "type": "number",
            "description": "The default zoom level of the map. A number from 0 to 19. See https://wiki.openstreetmap.org/wiki/Zoom_levels",
            "default": 12
          },
          "osm_relation_id": {
            "type": "integer",
            "description": "The relation identifier that encloses the region of the tenant. You can find this through https://www.openstreetmap.org. Search for the place, click on the correct result and you'll find the relation id if the result is a relation (e.g. \"Relation: Knokke-Heist (4569)\"). If the no correct relation is present amongst the results (e.g. Scheveningen), search for the smallest enclosing region (e.g. The Hague)"
          }
        }
      },
      "user_custom_fields": {
        "type": "object",
        "description":  "Allows admin to define their own form fields that users can fill out at sign up",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },
      "clustering": {
        "type": "object",
        "description":  "Allows admins to analyze ideas by creating clustered visualizations",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": false},
          "enabled": { "type": "boolean", "default": false}
        }
      },
      "widgets": {
        "type": "object",
        "description":  "Allows admins to generate platform content widgets, embeddable on external websites",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },
      "ideaflow_social_sharing": {
        "type": "object",
        "description":  "A social sharing option is presented after posting an idea",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },
      "granular_permissions": {
        "type": "object",
        "description":  "Choose which users are permitted to take which actions (e.g. posting, voting) in which projects/phases",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": false},
          "enabled": { "type": "boolean", "default": false}
        }
      },
      "participatory_budgeting": {
        "type": "object",
        "description":  "Participation methods where citizens can spend a limited budget on ideas that have a cost",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": false},
          "enabled": { "type": "boolean", "default": false}
        }
      },
      "manual_emailing": {
        "type": "object",
        "description":  "Allows admins and moderators to send out direct email to groups of citizens",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },
      "automated_emailing_control": {
        "type": "object",
        "description":  "Allows admins to control which automated e-mail campaigns are active",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },
      "machine_translations": {
        "type": "object",
        "description":  "Allows users to see translated content.",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": true}
        }
      },
      "similar_ideas": {
        "type": "object",
        "description":  "Show links to similar ideas on the idea page. PoC, not yet stable.",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": true},
          "enabled": { "type": "boolean", "default": false}
        }
      },
      "geographic_dashboard": {
        "type": "object",
        "description":  "Shows a map with automatically detected idea locations. PoC, not yet stable.",
        "additionalProperties": false,
        "required": ["allowed", "enabled"],
        "properties": {
          "allowed": { "type": "boolean", "default": false},
          "enabled": { "type": "boolean", "default": false}
        }
      }
    },
  "dependencies": {
    "projects_info": ["projects"],
    "projects_pages": ["projects"],
    "projects_events": ["projects"],
    "projects_phases": ["projects"],
    "private_projects": ["groups"],
    "typeform_surveys": ["surveys"],
    "google_forms_surveys": ["surveys"],
    "surveymonkey_surveys": ["surveys"]
  },
  "definitions": {
    "multiloc_string": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        <%= CL2_SUPPORTED_LOCALES.map{|l| "\"#{l.to_s}\": {\"type\": \"string\"}"}.join(",") %>
      }
    }
  }
}
